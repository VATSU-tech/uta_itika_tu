<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content="uta itika tu" />
    <meta name="keywords" content="uta itika tu" />
    <meta name="author" content="VATSU" />
    <meta name="robots" content="index, follow" />
    <meta name="theme-color" content="var(--background)" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="msapplication-TileColor" content="var(--background)" />
    <meta name="msapplication-TileImage" content="icon.svg" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;500;700&family=Playfair+Display:wght@500;700&display=swap"
      rel="stylesheet"
    />
    <link rel="icon" href="" id="pageIcon" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css"
      integrity="sha512-2SwdPD6INVrV/lHTZbO2nodKhrnDdJK9/kg2XD1r9uGqPo1cUbujc+IYdlYdEErWNu69gVcYgdxlmVmzTWnetw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <title id="title" > uta itika tu</title>
  </head>
  <style>
    * {
      padding: 0;
      margin: 0;
      box-sizing: border-box;
      font-family:
        "Manrope",
        "Segoe UI",
        sans-serif;
        font-size: calc(.8rem + 1vw);
      transition: 0.5s;
    }
    :root {
      /* --background: #1f1f1f;
      --color2: #1a1a1a;
      --color3: #313131;
      --white: #414141; */
     --background: #ffb8b8;
      --color2: #ff6767;
      --color3: #ff000075;
      --white: #ff0000;
    }
    body {
      overflow: hidden;
      background:
        radial-gradient(circle at 20% 10%, #ffd6d6 0%, transparent 45%),
        radial-gradient(circle at 80% 20%, #ff8b8b 0%, transparent 40%),
        var(--background);
      color: var(--white);
      display: flex;
      justify-content: center;
      align-items:center;
      height: 100vh;
      position: relative; /* Needed for absolute positioning of children */
    }
    main {
      position: relative;
      width: 100%;
      height: 100vh;
    }
    .view {
      position: absolute;
      inset: 0;
      display: grid;
      place-items: center;
      padding: 2rem;
    }
    .view[hidden] {
      display: none !important;
    }
    .container {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      background-color: transparent;
      color: var(--white);
      padding: 2rem;
      border-radius: 2rem;
      text-align: center;
      box-shadow:
        var(--color2) 0 0 50rem,
        /* #0000002a 5px 5px 1rem, */
        var(--white) 5px 5px 1rem,
        var(--color3) 0 0 7rem inset;
      z-index: 10; /* Ensure content is above bubbles */
      position: relative;
    }
    .message-panel {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
      width: min(900px, 92vw);
      background-color: transparent;
      color: var(--white);
      padding: 2rem;
      border-radius: 2rem;
      text-align: center;
      box-shadow:
        var(--color2) 0 0 50rem,
        var(--white) 5px 5px 1rem,
        var(--color3) 0 0 7rem inset;
      z-index: 10;
      position: relative;
    }
    .scroll-window {
      position: relative;
      height: min(55vh, 480px);
      overflow: hidden;
      border-radius: 1.5rem;
      padding: 1rem;
      background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0));
    }
    .scroll-text {
      position: absolute;
      left: 0;
      right: 0;
      padding: 0 0.5rem;
      animation: scrollUp 40s linear forwards;
    }
    .scroll-text p {
      margin-bottom: 1.25rem;
      line-height: 1.6;
    }
    .cta {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1rem;
    }
    .message{
      animation: header 2s ease-in-out;
    }
    @keyframes header {
      0%,100%{
        top: -2rem;
      }
      10%,70%{
        top: 1rem;
      }
    }
    .header{
      position: absolute;
      top: -10rem;
    }
    h1 {
      font-family: "Playfair Display", serif;
      color:var(--color2);
      animation: fadenRed 2s ease-in-out infinite;
    }
    @keyframes fadenRed {
      0%,100%{
      text-shadow: #dee 0 0 5px;
      }
      50%{
      text-shadow: var(--color3) 0 0 1px;
      }
      
    }
    .section {
      display: flex;
      gap: 10px;
      padding: 0 20%;
      justify-content: center;
    }
    button {
      width: 100px;
      background-color: var(--background);
      border: 1px solid var(--color2);
      padding: 1rem;
      border-radius: 2rem;
      color: var(--white);
      position: relative; /* For movement */
    }
    button:hover {
      border-color: var(--color2);
      cursor: pointer;
      box-shadow: var(--color2) 0 0 1rem inset;
    }
    .hover {
      position: absolute; /* Allows free movement */
    }
    footer {
      position: absolute;
      bottom: 10px;
      z-index: 10;
    }
    a {
      text-decoration: none;
      opacity: .2;
      color: var(--white);
    }
    a:hover {
      opacity: 1;
    }

    /* Bubble Styles */
    .bulle {
      position: absolute;
      bottom: -100px; /* Start below screen */
      animation: rise linear forwards; /* 'forwards' helps debugging, but we remove element anyway */
      z-index: 1; /* Behind content */
      opacity: 0.7;
    }

    @keyframes rise {
      0% {
        transform: translateY(0) rotate(0deg);
        opacity: 0;
      }
      10% {
        opacity: 1;
      }
      100% {
        transform: translateY(-120vh) rotate(360deg); /* Move up past viewport */
        opacity: 0;
      }
    }
    @keyframes scrollUp {
      0% {
        transform: translateY(100%);
      }
      100% {
        transform: translateY(-120%);
      }
    }
    @media (prefers-reduced-motion: reduce) {
      .scroll-text {
        position: static;
        animation: none;
      }
    }
  </style>
  <body>
    <main>
      <section id="message" class="view">
        <div class="message-panel">
          <h1>Un petit message pour toi</h1>
          <div class="scroll-window">
            <div class="scroll-text" id="scrollText">
              <p>Ã‰cris ici ton long message. Il va dÃ©filer doucement de bas en haut.</p>
              <p>Tu peux ajouter plusieurs paragraphes pour raconter ce que tu veux.</p>
              <p>Quand le texte arrive Ã  la fin, la question dâ€™autorisation apparaÃ®t.</p>
              <p>Ce bloc est un exemple. Remplace-le par ton vrai texte.</p>
              <p>Merci dâ€™Ãªtre lÃ . Ce moment compte pour moi.</p>
              <div class="cta" id="pausePoint">
                <span>Je peux te poser une question ?</span>
                <button id="startQuestion">Oui</button>
              </div>
            </div>
          </div>
        </div>
      </section>
      <section id="question" class="view" hidden>
        <div id="header" class="header">header</div>
        <div class="container">
          <h1 id="q">Veut tu etre ma valentine ?</h1>
          <div class="section">
            <button id="yes" onclick='send("yes","Merci ðŸ’˜",noCompteur)' >Yes</button>
            <button id="button">No</button>
          </div>
        </div>
      </section>
    </main>
    <footer>
      <a href="https://github.com/VATSU-tech/uta_itika_tu.git"
        ><i class="fa-brands fa-github"></i> VATSU-tech</a
      >
    </footer>

    <script>
      const p = new URLSearchParams(location.search);
      const to = p.get("to") || "Valentine";
      const from = p.get("num") || "Quelquâ€™un";
      document.getElementById("q").innerHTML =
        `<span class='to'>${to}</span>` + ", veux-tu Ãªtre ma Valentine ?";

      function send(answer,message,noCompt) {
        fetch("/api/respond", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ to, from, answer,noCompt }),
        }).then(() => {
          document.querySelector('.container').innerHTML = `<h2 style='color:var(--whire)'>${message}</h2>
          <p><a href='https://wa.me/${from}?text=${answer}' target='_blank'><button style='width:15rem'>Envoyer sur Whatsap</button></a></p>
          `
        });
      }

      // btn.addEventListener('click',()=>{navigator.sendBeacon(
      //     "/api/response",
      //     JSON.stringify({ to, from, answer:'quitter',noCompt }),
      //   );}
      // )

      // window.addEventListener("beforeunload", () => {
      //   navigator.sendBeacon(
      //     "/api/response",
      //     JSON.stringify({ to, from, answer:'quitter',noCompt }),
      //   );
      // });

    pageIcon.href ='icon.svg'
    document.getElementById('title').textContent =  to

    const btn = document.getElementById("button");
    const msg = document.getElementById('header');
    const root = document.documentElement;
    let noCompteur = 0;
    let srcIcon = 'icon'
    const container = document.querySelector(".container");
    const messageSection = document.getElementById("message");
    const questionSection = document.getElementById("question");
    const scrollText = document.getElementById("scrollText");
    const pausePoint = document.getElementById("pausePoint");
    const scrollWindow = document.querySelector(".scroll-window");
    const startQuestion = document.getElementById("startQuestion");

    const messages = ['Fais pas cet erreur','Derniere chance','C\'est pas bien ca']

    btn.addEventListener("click", moveButton); // Also move on click if they manage to catch it

    function moveButton() {
      if(messages.length !== 0){
        noCompteur ++;
        msg.textContent = messages[0]  
        messages.splice(0,1)
        console.log(messages);
      }
      else{
        root.style.setProperty('--background', '#1f1f1f')
        root.style.setProperty('--color2','#1a1a1a');
        root.style.setProperty('--color3','#313131')
        root.style.setProperty('--white','#afafaf')
        srcIcon = 'broken'
        pageIcon.href ='broken.svg'
        send('no','Tu me rend vraiment triste','acha katala')
        document.getElementById('title').textContent  = `tu me rend triste
          <p><a href='https://wa.me/${from}?text=${answer}' target='_blank'><button style='width=15rem'>Envoyer sur Whatsap</button></a></p>`
      }
      

      msg.classList.add('message')
      // msg.style.animation = 'header 2s ease-in-out'
      setTimeout(()=> msg.classList.remove('message'),2000)
      if (!btn.classList.contains("hover")) {
        btn.classList.add("hover");
        btn.style.position = "fixed";
      }

      const x = Math.random() * (window.innerWidth - btn.offsetWidth);
      const y = Math.random() * (window.innerHeight - btn.offsetHeight);

      btn.style.left = x + "px";
      btn.style.top = y + "px";
    }

    document.getElementById("yes").addEventListener("click", () => {
      for (let i = 0; i < 50; i++) {
        setTimeout(()=>prodBulles('love'), i * 30);
      }
    });

    const audion = new Audio('audio.mp3');
    audion.volume = 0.2;
    audion.loop = true;
    const tryPlayAudio = () => {
      audion.play().catch(() => {});
    };
    tryPlayAudio();
    document.addEventListener("pointerdown", tryPlayAudio, { once: true });

    const showQuestion = () => {
      messageSection.hidden = true;
      questionSection.hidden = false;
    };

    const prefersReducedMotion = window.matchMedia("(prefers-reduced-motion: reduce)");
    if (!prefersReducedMotion.matches) {
      let paused = false;
      const checkPause = () => {
        if (paused) return;
        const windowRect = scrollWindow.getBoundingClientRect();
        const pointRect = pausePoint.getBoundingClientRect();
        const windowMid = windowRect.top + windowRect.height / 2;
        const pointMid = pointRect.top + pointRect.height / 2;
        const distance = Math.abs(pointMid - windowMid);
        if (distance < 12) {
          scrollText.style.animationPlayState = "paused";
          paused = true;
          return;
        }
        requestAnimationFrame(checkPause);
      };
      requestAnimationFrame(checkPause);
    }

    startQuestion.addEventListener("click", () => {
      showQuestion();
    });

    const prodBulles = (src) => {
      const bulle = document.createElement("img");
      bulle.src = `/${src}.svg`
      bulle.alt = src
      bulle.classList.add("bulle");

      const size = Math.random() * 50 + 20 + "px"; 
      bulle.style.width = size;
      bulle.style.height = size;

      bulle.style.left = Math.random() * 100 + "%";

      const duration = Math.random() * 15 + 10; 
      bulle.style.animationDuration = duration + "s";

      // Random Delay
      bulle.style.animationDelay = Math.random() * 2 + "s";

      document.body.appendChild(bulle);

      // Cleanup after animation
      setTimeout(
        () => {
          bulle.remove();
        },
        (duration + 2) * 1000,
      ); // Wait for duration + delay
    };
    setInterval(()=>prodBulles(srcIcon), 800);
    </script>
  </body>
</html>
